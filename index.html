<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>YouTube Multi Stream Viewer</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: var(--bg, #121212);
        color: var(--text, #fff);
        margin: 0;
        padding: 10px;
        transition: background-color 0.3s, color 0.3s;
    }
    .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        margin-bottom: 10px;
    }
    input, button {
        padding: 6px;
        font-size: 14px;
    }
    .stream-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .stream-card {
        background: var(--card, #1e1e1e);
        border-radius: 8px;
        overflow: hidden;
        flex: 1 1 500px;
        display: flex;
        flex-direction: column;
        transition: background 0.3s;
    }
    .stream-header {
        padding: 5px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .video-chat-wrapper {
        display: flex;
        flex-direction: row;
        height: 360px;
    }
    iframe {
        border: none;
    }
    .video-frame {
        flex: 2;
    }
    .chat-frame {
        flex: 1;
        border-left: 1px solid #444;
    }
    .slider {
        width: 100px;
    }
    @media (max-width: 768px) {
        .video-chat-wrapper {
            flex-direction: column;
            height: auto;
        }
        .chat-frame {
            border-left: none;
            border-top: 1px solid #444;
            height: 300px;
        }
    }
</style>
</head>
<body>

<div class="controls">
    <input type="text" id="youtubeLink" placeholder="Paste YouTube link">
    <button onclick="addStream()">Add Stream</button>
    <button onclick="toggleTheme()">Toggle Dark/Light</button>
</div>

<div class="stream-container" id="streamContainer"></div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
    let players = {};
    let darkMode = true;

    function toggleTheme() {
        darkMode = !darkMode;
        document.body.style.setProperty('--bg', darkMode ? '#121212' : '#ffffff');
        document.body.style.setProperty('--text', darkMode ? '#ffffff' : '#000000');
        document.body.style.setProperty('--card', darkMode ? '#1e1e1e' : '#f4f4f4');
    }

    function getVideoId(url) {
        const regex = /(?:youtu\.be\/|youtube\.com\/(?:watch\?v=|live\/|shorts\/|embed\/))([\w-]{11})/;
        const match = url.match(regex);
        return match ? match[1] : null;
    }

    function addStream() {
        const link = document.getElementById('youtubeLink').value.trim();
        if (!link) return;
        const videoId = getVideoId(link);
        if (!videoId) {
            alert('Invalid YouTube link');
            return;
        }

        const container = document.getElementById('streamContainer');

        // Create card
        const card = document.createElement('div');
        card.className = 'stream-card';
        card.id = `card-${videoId}`;

        const header = document.createElement('div');
        header.className = 'stream-header';

        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'Remove';
        removeBtn.onclick = () => {
            if (players[videoId]) {
                players[videoId].destroy();
                delete players[videoId];
            }
            card.remove();
        };

        const volumeSlider = document.createElement('input');
        volumeSlider.type = 'range';
        volumeSlider.min = 0;
        volumeSlider.max = 100;
        volumeSlider.value = 50;
        volumeSlider.className = 'slider';
        volumeSlider.oninput = (e) => {
            if (players[videoId]) {
                players[videoId].setVolume(e.target.value);
            }
        };

        header.appendChild(removeBtn);
        header.appendChild(volumeSlider);

        const wrapper = document.createElement('div');
        wrapper.className = 'video-chat-wrapper';

        const videoDiv = document.createElement('div');
        videoDiv.className = 'video-frame';
        videoDiv.id = `player-${videoId}`;

        const chatIframe = document.createElement('iframe');
        chatIframe.className = 'chat-frame';
        chatIframe.src = `https://www.youtube.com/live_chat?v=${videoId}&embed_domain=${location.hostname}`;
        chatIframe.allowFullscreen = true;

        wrapper.appendChild(videoDiv);
        wrapper.appendChild(chatIframe);

        card.appendChild(header);
        card.appendChild(wrapper);
        container.appendChild(card);

        // Init YouTube player
        new YT.Player(`player-${videoId}`, {
            videoId: videoId,
            playerVars: { autoplay: 0 },
            events: {
                onReady: (event) => {
                    players[videoId] = event.target;
                    event.target.setVolume(50);
                }
            }
        });

        document.getElementById('youtubeLink').value = '';
    }

    function onYouTubeIframeAPIReady() {
        console.log('YouTube API Ready');
    }
</script>
</body>
</html>

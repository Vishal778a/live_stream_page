<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>YouTube Multi Stream with Chat</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: #f5f5f5;
  }
  .container {
    padding: 10px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 10px;
  }
  .card {
    background: #fff;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 0 5px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
  }
  .frame {
    width: 100%;
    height: 200px;
    border: none;
  }
  .info {
    padding: 8px;
  }
  .title {
    margin: 0 0 4px 0;
    font-size: 14px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .meta {
    font-size: 12px;
    color: #555;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .badge {
    background: red;
    color: #fff;
    padding: 2px 5px;
    font-size: 10px;
    border-radius: 3px;
  }
  .remove {
    position: absolute;
    right: 5px;
    top: 5px;
    background: rgba(0,0,0,0.6);
    color: #fff;
    border: none;
    cursor: pointer;
    border-radius: 50%;
    width: 24px;
    height: 24px;
  }
  .card-wrapper {
    position: relative;
  }
  .chat-container {
    background: #f9f9f9;
  }
  .controls {
    padding: 5px 8px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .chat-toggle {
    background: #0073e6;
    color: white;
    border: none;
    padding: 5px 8px;
    font-size: 12px;
    border-radius: 4px;
    cursor: pointer;
  }
</style>
</head>
<body>

<div style="padding:10px;">
  <input type="text" id="streamUrl" placeholder="Paste YouTube link..." style="width:70%;">
  <button id="addBtn">Add Stream</button>
</div>

<div class="container" id="grid"></div>

<script>
const el = {
  grid: document.getElementById("grid"),
  addBtn: document.getElementById("addBtn"),
  urlInput: document.getElementById("streamUrl")
};

let streams = [];

function escapeHtml(str) {
  return str.replace(/[&<>'"]/g, tag => ({
    '&':'&amp;', '<':'&lt;', '>':'&gt;', "'":'&#39;', '"':'&quot;'
  }[tag] || tag));
}

function extractVideoId(url) {
  try {
    const u = new URL(url);
    if (u.hostname.includes("youtube.com")) {
      if (u.searchParams.get("v")) return u.searchParams.get("v");
      if (u.pathname.startsWith("/embed/")) return u.pathname.split("/")[2];
    }
    if (u.hostname === "youtu.be") return u.pathname.substring(1);
  } catch {}
  return "";
}

function createEmbedUrl(videoId) {
  return `https://www.youtube.com/embed/${videoId}?autoplay=1`;
}

function render() {
  el.grid.innerHTML = "";
  streams.forEach((s, idx) => {
    const wrapper = document.createElement("div");
    wrapper.className = "card-wrapper";

    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <button class="remove" title="Remove" data-idx="${idx}">Ã—</button>
      <iframe class="frame" src="${s.embed}" allowfullscreen></iframe>
      <div class="controls">
        <label>Volume:
          <input type="range" min="0" max="100" value="${s.volume}" data-idx="${idx}">
        </label>
        <button class="chat-toggle" data-idx="${idx}">ðŸ’¬ Chat</button>
      </div>
      <div class="info">
        <h3 class="title" title="${escapeHtml(s.title)}">${escapeHtml(s.title)}</h3>
        <div class="meta">
          <span>${escapeHtml(s.author || 'YouTube')}</span>
          <span class="badge">LIVE</span>
        </div>
      </div>
      <div class="chat-container" style="display:none; max-height:300px;">
        <iframe 
          class="chat-frame"
          src="https://www.youtube.com/live_chat?v=${extractVideoId(s.embed)}&embed_domain=${location.hostname}" 
          frameborder="0"
          style="width:100%;height:300px;">
        </iframe>
      </div>
    `;

    wrapper.appendChild(card);
    el.grid.appendChild(wrapper);
  });

  // Remove
  document.querySelectorAll(".remove").forEach(btn => {
    btn.addEventListener("click", e => {
      streams.splice(e.target.dataset.idx, 1);
      render();
    });
  });

  // Volume slider (affects iframe with JS API - placeholder)
  document.querySelectorAll('input[type="range"]').forEach(slider => {
    slider.addEventListener("input", e => {
      streams[e.target.dataset.idx].volume = e.target.value;
    });
  });

  // Chat toggle
  document.querySelectorAll(".chat-toggle").forEach(btn => {
    btn.addEventListener("click", e => {
      const chatBox = e.target.closest(".card").querySelector(".chat-container");
      chatBox.style.display = chatBox.style.display === "none" ? "block" : "none";
    });
  });
}

el.addBtn.addEventListener("click", () => {
  const url = el.urlInput.value.trim();
  if (!url) return;
  const vid = extractVideoId(url);
  if (!vid) {
    alert("Invalid YouTube channel/video link");
    return;
  }
  streams.push({
    embed: createEmbedUrl(vid),
    title: `Stream ${streams.length + 1}`,
    author: "YouTube",
    volume: 50
  });
  el.urlInput.value = "";
  render();
});
</script>

</body>
</html>
